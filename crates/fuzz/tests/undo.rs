use fuzz::{
    actions::{ActionWrapper::*, GenericAction},
    crdt_fuzzer::{test_multi_sites, Action::*, FuzzTarget, FuzzValue::*},
};
use loro_common::ContainerType::*;

#[ctor::ctor]
fn init() {
    dev_utils::setup_test_log();
}

#[test]
fn undo_tree_with_map() {
    test_multi_sites(
        5,
        vec![FuzzTarget::Tree],
        &mut [
            Handle {
                site: 174,
                target: 0,
                container: 0,
                action: Generic(GenericAction {
                    value: I32(117440512),
                    bool: true,
                    key: 1275068415,
                    pos: 18446743068687204667,
                    length: 46161896180416511,
                    prop: 18446463698227691775,
                }),
            },
            SyncAll,
            Handle {
                site: 0,
                target: 0,
                container: 0,
                action: Generic(GenericAction {
                    value: I32(-12976128),
                    bool: true,
                    key: 131071,
                    pos: 3399988123389597184,
                    length: 3400000218017509167,
                    prop: 3399988123389603631,
                }),
            },
            Handle {
                site: 0,
                target: 0,
                container: 0,
                action: Generic(GenericAction {
                    value: I32(791621423),
                    bool: true,
                    key: 791621423,
                    pos: 18372433783001394991,
                    length: 13281205459693609,
                    prop: 18446744069425331619,
                }),
            },
            SyncAll,
            SyncAllUndo {
                site: 149,
                op_len: 65533,
            },
        ],
    );
}

#[test]
fn redo_tree_id_diff() {
    test_multi_sites(
        2,
        vec![FuzzTarget::All],
        &mut [
            Handle {
                site: 51,
                target: 60,
                container: 197,
                action: Generic(GenericAction {
                    value: I32(-296905323),
                    bool: false,
                    key: 2395151462,
                    pos: 6335698875578771752,
                    length: 1716855125946684615,
                    prop: 2807457672376879961,
                }),
            },
            Handle {
                site: 162,
                target: 167,
                container: 90,
                action: Generic(GenericAction {
                    value: Container(Tree),
                    bool: true,
                    key: 929442508,
                    pos: 4887648083275096983,
                    length: 8237173174339417107,
                    prop: 1571041097810100079,
                }),
            },
            Checkout {
                site: 56,
                to: 1826343396,
            },
            SyncAllUndo {
                site: 10,
                op_len: 998370061,
            },
            Handle {
                site: 112,
                target: 78,
                container: 159,
                action: Generic(GenericAction {
                    value: Container(MovableList),
                    bool: false,
                    key: 1978700208,
                    pos: 15377364763518525973,
                    length: 13205966979381542996,
                    prop: 5155832222345785212,
                }),
            },
        ],
    );
}

#[test]
fn tree_delete() {
    test_multi_sites(
        5,
        vec![FuzzTarget::All],
        &mut [
            Handle {
                site: 33,
                target: 147,
                container: 2,
                action: Generic(GenericAction {
                    value: I32(2071690107),
                    bool: true,
                    key: 2223278715,
                    pos: 11357407135578037636,
                    length: 11357407135578037661,
                    prop: 11357407135578037661,
                }),
            },
            SyncAllUndo {
                site: 223,
                op_len: 33721747,
            },
            Handle {
                site: 2,
                target: 2,
                container: 255,
                action: Generic(GenericAction {
                    value: I32(-1971618949),
                    bool: false,
                    key: 2644345988,
                    pos: 11357407135578037661,
                    length: 11357407135578037661,
                    prop: 11357407135578037661,
                }),
            },
            SyncAllUndo {
                site: 157,
                op_len: 2644352413,
            },
        ],
    )
}

#[test]
fn tree_undo_delete_with_diff_old_index() {
    test_multi_sites(
        5,
        vec![FuzzTarget::All],
        &mut [
            Handle {
                site: 27,
                target: 27,
                container: 27,
                action: Generic(GenericAction {
                    value: I32(454761243),
                    bool: true,
                    key: 4280621851,
                    pos: 1953184669377757183,
                    length: 1953184666628070171,
                    prop: 71829045943205915,
                }),
            },
            Handle {
                site: 251,
                target: 197,
                container: 255,
                action: Generic(GenericAction {
                    value: I32(454761243),
                    bool: true,
                    key: 454761243,
                    pos: 1953184666628070171,
                    length: 16710579922159737627,
                    prop: 288230380914862055,
                }),
            },
            Handle {
                site: 27,
                target: 27,
                container: 27,
                action: Generic(GenericAction {
                    value: I32(387661595),
                    bool: false,
                    key: 454761243,
                    pos: 1953184666628070171,
                    length: 71829045943205915,
                    prop: 18430413027502194837,
                }),
            },
            Handle {
                site: 27,
                target: 27,
                container: 27,
                action: Generic(GenericAction {
                    value: I32(454761243),
                    bool: true,
                    key: 454761243,
                    pos: 16710579922159737627,
                    length: 288230380914862055,
                    prop: 1953184666628070171,
                }),
            },
            Handle {
                site: 63,
                target: 27,
                container: 23,
                action: Generic(GenericAction {
                    value: I32(454761243),
                    bool: true,
                    key: 454761243,
                    pos: 1953184666628070171,
                    length: 1953184666628070171,
                    prop: 1953184666627808027,
                }),
            },
            SyncAll,
            Handle {
                site: 27,
                target: 27,
                container: 27,
                action: Generic(GenericAction {
                    value: I32(454761243),
                    bool: false,
                    key: 807600128,
                    pos: 29802787832063,
                    length: 163831513883392,
                    prop: 2527082340907941888,
                }),
            },
            Handle {
                site: 27,
                target: 27,
                container: 27,
                action: Generic(GenericAction {
                    value: I32(-1920103141),
                    bool: true,
                    key: 2374864269,
                    pos: 10199964370168810893,
                    length: 10199964370168810893,
                    prop: 10199964370168810893,
                }),
            },
            SyncAllUndo {
                site: 141,
                op_len: 2374864269,
            },
        ],
    )
}

#[test]
fn tree_undo_delete_parent_in_b() {
    test_multi_sites(
        5,
        vec![FuzzTarget::All],
        &mut [
            Handle {
                site: 129,
                target: 207,
                container: 96,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 1478566177,
                    pos: 2387225703656530209,
                    length: 388195770586702113,
                    prop: 18446743116485501224,
                }),
            },
            SyncAll,
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331665,
                    pos: 17216961135462248175,
                    length: 1229782938247303441,
                    prop: 1229782938247303441,
                }),
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 1229782938247303441,
                    length: 1229782938247303441,
                    prop: 1229782938247303441,
                }),
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331137),
                    bool: true,
                    key: 286331153,
                    pos: 4256201887840276755,
                    length: 1229782946837238033,
                    prop: 1229782938247303441,
                }),
            },
            SyncAll,
            Handle {
                site: 0,
                target: 2,
                container: 5,
                action: Generic(GenericAction {
                    value: Container(MovableList),
                    bool: true,
                    key: 2145059327,
                    pos: 4050480110299788081,
                    length: 18157383382424616754,
                    prop: 18157383382357244923,
                }),
            },
            Undo {
                site: 255,
                op_len: 4227596287,
            },
            Handle {
                site: 223,
                target: 47,
                container: 184,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4227595259,
                    pos: 18157383382357244923,
                    length: 2387225703656586235,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            Undo {
                site: 17,
                op_len: 3823363055,
            },
            SyncAll,
            Handle {
                site: 17,
                target: 17,
                container: 243,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 1229782942240280849,
                    length: 1229782869527826705,
                    prop: 1229785137270558993,
                }),
            },
            Checkout {
                site: 17,
                to: 319885585,
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 16501207799683944947,
                    length: 2676586395008832811,
                    prop: 40841467208997,
                }),
            },
            Handle {
                site: 243,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286332177),
                    bool: true,
                    key: 286327027,
                    pos: 1229782938247303441,
                    length: 1229782938247303441,
                    prop: 1229782938247303658,
                }),
            },
            SyncAllUndo {
                site: 135,
                op_len: 2273806215,
            },
        ],
    )
}

#[test]
fn tree_undo_move_parent_deleted_in_b() {
    test_multi_sites(
        5,
        vec![FuzzTarget::All],
        &mut [
            Handle {
                site: 129,
                target: 207,
                container: 96,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 1478566177,
                    pos: 2387225703656530209,
                    length: 388195770586702113,
                    prop: 18446743116485501224,
                }),
            },
            SyncAll,
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331665,
                    pos: 17216961135462248175,
                    length: 1229782938247303441,
                    prop: 1229782938247303441,
                }),
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 1229782938247303441,
                    length: 1229782938247303441,
                    prop: 1229782938247303441,
                }),
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331137),
                    bool: true,
                    key: 286331153,
                    pos: 4256201887840276755,
                    length: 1229782946837238033,
                    prop: 1229782938247303441,
                }),
            },
            SyncAll,
            Handle {
                site: 0,
                target: 2,
                container: 5,
                action: Generic(GenericAction {
                    value: Container(MovableList),
                    bool: true,
                    key: 2145059327,
                    pos: 4050480110299788081,
                    length: 18157383382424616754,
                    prop: 18157383382357244923,
                }),
            },
            // create
            Handle {
                site: 0,
                target: 2,
                container: 5,
                action: Generic(GenericAction {
                    value: Container(MovableList),
                    bool: true,
                    key: 2145059327,
                    pos: 4050480110299788081,
                    length: 18157383382424616754,
                    prop: 18157383382357244923,
                }),
            },
            Handle {
                site: 0,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286332177),
                    bool: true,
                    key: 286327027,
                    pos: 1229782938247303441,
                    length: 1229782938247303441,
                    prop: 1229782938247303658,
                }),
            },
            Handle {
                site: 223,
                target: 47,
                container: 184,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4227595259,
                    pos: 18157383382357244923,
                    length: 2387225703656586235,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            Undo {
                site: 17,
                op_len: 3823363055,
            },
            SyncAll,
            Handle {
                site: 17,
                target: 17,
                container: 243,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 1229782942240280849,
                    length: 1229782869527826705,
                    prop: 1229785137270558993,
                }),
            },
            Checkout {
                site: 17,
                to: 319885585,
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 16501207799683944947,
                    length: 2676586395008832811,
                    prop: 40841467208997,
                }),
            },
            Handle {
                site: 243,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286332177),
                    bool: true,
                    key: 286327027,
                    pos: 1229782938247303441,
                    length: 1229782938247303441,
                    prop: 1229782938247303658,
                }),
            },
            SyncAllUndo {
                site: 135,
                op_len: 2273806215,
            },
        ],
    )
}

#[test]
fn tree_undo_move_deleted_in_b() {
    test_multi_sites(
        5,
        vec![FuzzTarget::All],
        &mut [
            Handle {
                site: 129,
                target: 207,
                container: 96,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 1478566177,
                    pos: 2387225703656530209,
                    length: 388195770586702113,
                    prop: 18446743116485501224,
                }),
            },
            SyncAll,
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331665,
                    pos: 17216961135462248175,
                    length: 1229782938247303441,
                    prop: 1229782938247303441,
                }),
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 1229782938247303441,
                    length: 1229782938247303441,
                    prop: 1229782938247303441,
                }),
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331137),
                    bool: true,
                    key: 286331153,
                    pos: 4256201887840276755,
                    length: 1229782946837238033,
                    prop: 1229782938247303441,
                }),
            },
            SyncAll,
            Handle {
                site: 0,
                target: 2,
                container: 5,
                action: Generic(GenericAction {
                    value: Container(MovableList),
                    bool: true,
                    key: 2145059327,
                    pos: 4050480110299788081,
                    length: 18157383382424616754,
                    prop: 18157383382357244923,
                }),
            },
            // create
            Handle {
                site: 0,
                target: 2,
                container: 5,
                action: Generic(GenericAction {
                    value: Container(MovableList),
                    bool: true,
                    key: 2145059327,
                    pos: 4050480110299788081,
                    length: 18157383382424616754,
                    prop: 18157383382357244923,
                }),
            },
            Handle {
                site: 0,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286332177),
                    bool: true,
                    key: 286327027,
                    pos: 0,
                    length: 1,
                    prop: 2,
                }),
            },
            Handle {
                site: 223,
                target: 47,
                container: 184,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4227595259,
                    pos: 18157383382357244923,
                    length: 2387225703656586235,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            Undo {
                site: 17,
                op_len: 3823363055,
            },
            SyncAll,
            Handle {
                site: 17,
                target: 17,
                container: 243,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 0,
                    length: 1229782869527826705,
                    prop: 1229785137270558993,
                }),
            },
            Handle {
                site: 17,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286331153),
                    bool: true,
                    key: 286331153,
                    pos: 0,
                    length: 2676586395008832811,
                    prop: 1,
                }),
            },
            Handle {
                site: 243,
                target: 17,
                container: 17,
                action: Generic(GenericAction {
                    value: I32(286332177),
                    bool: true,
                    key: 286327027,
                    pos: 1229782938247303441,
                    length: 1229782938247303441,
                    prop: 1229782938247303658,
                }),
            },
            SyncAllUndo {
                site: 135,
                op_len: 2273806215,
            },
        ],
    )
}

#[test]
fn tree_diff_position() {
    test_multi_sites(
        5,
        vec![FuzzTarget::Tree],
        &mut [
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(117901063),
                    bool: true,
                    key: 4294903559,
                    pos: 18446744073709551615,
                    length: 18446744070186336255,
                    prop: 506381209882853375,
                }),
            },
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-1),
                    bool: true,
                    key: 4294967295,
                    pos: 18446744069566171401,
                    length: 18446744073709027327,
                    prop: 15355022929519706111,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 151650303,
                    pos: 18446744073709488393,
                    length: 18446744073709551607,
                    prop: 2242546323825885183,
                }),
            },
            Handle {
                site: 31,
                target: 255,
                container: 255,
                action: Generic(GenericAction {
                    value: Container(Text),
                    bool: true,
                    key: 4294904073,
                    pos: 18446744039349813247,
                    length: 18446744073709551615,
                    prop: 18446744073709540631,
                }),
            },
            Handle {
                site: 31,
                target: 31,
                container: 120,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 151587327,
                    pos: 17870283321406127881,
                    length: 18446744073709551615,
                    prop: 18446744073709551615,
                }),
            },
            SyncAllUndo {
                site: 255,
                op_len: 522190847,
            },
            SyncAllUndo {
                site: 255,
                op_len: 2543162669,
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-225),
                    bool: true,
                    key: 4294967295,
                    pos: 3746995852044863999,
                    length: 3689348814751478831,
                    prop: 3689349566361187123,
                }),
            },
            Handle {
                site: 0,
                target: 0,
                container: 203,
                action: Generic(GenericAction {
                    value: I32(-67160012),
                    bool: false,
                    key: 14354243,
                    pos: 18446512270787554605,
                    length: 132529457269757440,
                    prop: 3689631393508504599,
                }),
            },
            Sync { from: 154, to: 57 },
            Handle {
                site: 52,
                target: 52,
                container: 56,
                action: Generic(GenericAction {
                    value: I32(755030791),
                    bool: true,
                    key: 757935405,
                    pos: 18446744073558622207,
                    length: 18446642734358855679,
                    prop: 10798258750077476863,
                }),
            },
            SyncAllUndo {
                site: 149,
                op_len: 1101628309,
            },
            Checkout {
                site: 255,
                to: 797179861,
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-52481),
                    bool: true,
                    key: 4294967295,
                    pos: 2242545361753210879,
                    length: 18446743107869875999,
                    prop: 651333096108457983,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Checkout {
                site: 255,
                to: 797179861,
            },
            SyncAll,
            SyncAll,
            SyncAllUndo {
                site: 169,
                op_len: 4294913857,
            },
            SyncAll,
            Handle {
                site: 255,
                target: 255,
                container: 255,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 522190847,
                    pos: 3977020664822308639,
                    length: 18446744070240221241,
                    prop: 2242545361753210879,
                }),
            },
            Handle {
                site: 255,
                target: 255,
                container: 255,
                action: Generic(GenericAction {
                    value: Container(Text),
                    bool: true,
                    key: 4294967049,
                    pos: 18446744073709551615,
                    length: 651333096108457983,
                    prop: 18446744073709488393,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 213,
                target: 163,
                container: 255,
                action: Generic(GenericAction {
                    value: I32(-618717409),
                    bool: true,
                    key: 2509581823,
                    pos: 18387987999889921431,
                    length: 3423861436305875967,
                    prop: 18446744073694871551,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 120,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 2267596630907625247,
                    length: 18446744073709551391,
                    prop: 18446744073693429759,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 120,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 151587081,
                    pos: 18444492273895866367,
                    length: 18446744073709551615,
                    prop: 18446744072989704191,
                }),
            },
            Handle {
                site: 37,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-1),
                    bool: true,
                    key: 4294967295,
                    pos: 18446744069566171401,
                    length: 18446744073709027327,
                    prop: 2305843009213693951,
                }),
            },
            Handle {
                site: 120,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4278782217,
                    pos: 18446735277616529407,
                    length: 18446744073709551615,
                    prop: 18446744073706739711,
                }),
            },
            Checkout {
                site: 37,
                to: 2015305503,
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 255,
                target: 255,
                container: 255,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 18446744073709551615,
                    length: 2242792614424466711,
                    prop: 10749528904694701855,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 120,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294904319,
                    pos: 18446744073709551615,
                    length: 2267596630907625247,
                    prop: 18446744073709551391,
                }),
            },
            Handle {
                site: 9,
                target: 255,
                container: 255,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 18446744072989704191,
                    length: 2242551955064881151,
                    prop: 18446744069936740383,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 213,
                target: 163,
                container: 255,
                action: Generic(GenericAction {
                    value: I32(-618717409),
                    bool: true,
                    key: 2509581823,
                    pos: 18387987999889921431,
                    length: 3423861436305875967,
                    prop: 18446744073694871551,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 95,
                target: 120,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 2267596630907625247,
                    length: 18446744073709551391,
                    prop: 18446472533143846911,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAllUndo {
                site: 43,
                op_len: 2214581759,
            },
            SyncAll,
            SyncAll,
            SyncAllUndo {
                site: 131,
                op_len: 4281287081,
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 55,
                container: 57,
                action: Generic(GenericAction {
                    value: I32(-13552072),
                    bool: true,
                    key: 4294967295,
                    pos: 2242545357980434431,
                    length: 18400582177514266488,
                    prop: 651061559686070271,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Sync { from: 163, to: 255 },
            SyncAll,
            SyncAll,
            Sync { from: 163, to: 255 },
            Handle {
                site: 31,
                target: 31,
                container: 219,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 8655671227355963391,
                    length: 18446744073709494047,
                    prop: 18446744069582356479,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 120,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 151587327,
                    pos: 17870283321406127881,
                    length: 18446744073709551615,
                    prop: 18446708705056522239,
                }),
            },
            Handle {
                site: 31,
                target: 37,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-225),
                    bool: true,
                    key: 4294967295,
                    pos: 18446743013004216831,
                    length: 18446744073575333887,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 219,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 522190847,
                    pos: 18383446805802065695,
                    length: 18446744073709551414,
                    prop: 2242545361753210879,
                }),
            },
            Handle {
                site: 255,
                target: 255,
                container: 255,
                action: Generic(GenericAction {
                    value: Container(Text),
                    bool: true,
                    key: 4294967049,
                    pos: 18446744073575333887,
                    length: 1729382256910270463,
                    prop: 11817199131615536085,
                }),
            },
            SyncAllUndo {
                site: 47,
                op_len: 4280287231,
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 225,
                target: 224,
                container: 135,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 151650303,
                    pos: 18446744073709488393,
                    length: 18446744073709551607,
                    prop: 18420801199931391999,
                }),
            },
            SyncAllUndo {
                site: 43,
                op_len: 2214581759,
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Checkout {
                site: 55,
                to: 825636921,
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-1),
                    bool: true,
                    key: 4294967295,
                    pos: 18446744069566171401,
                    length: 18446743133111189503,
                    prop: 1729382256910270463,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 219,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 10922800496058040319,
                    length: 18446514557796193685,
                    prop: 18388060938407193507,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 95,
                action: Generic(GenericAction {
                    value: I32(-51457),
                    bool: true,
                    key: 4294967295,
                    pos: 2242545361753210879,
                    length: 18446743107869875999,
                    prop: 651333096108457983,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Checkout {
                site: 255,
                to: 797179861,
            },
            SyncAll,
            SyncAll,
            SyncAllUndo {
                site: 169,
                op_len: 4294913857,
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(522133279),
                    bool: true,
                    key: 354361208,
                    pos: 18374686479671623680,
                    length: 10798258750077476863,
                    prop: 18446743616657790357,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 255,
                action: Generic(GenericAction {
                    value: I32(522133279),
                    bool: false,
                    key: 4294909727,
                    pos: 720575940379279359,
                    length: 18446744073693366537,
                    prop: 18446744073709549567,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 37,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-225),
                    bool: true,
                    key: 4294967295,
                    pos: 18446743013004216831,
                    length: 18446744073575333887,
                    prop: 18446744073709551615,
                }),
            },
            Handle {
                site: 31,
                target: 120,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 151587081,
                    pos: 18444492273895866367,
                    length: 18446744073709551615,
                    prop: 18446744072989704191,
                }),
            },
            Handle {
                site: 37,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-1),
                    bool: true,
                    key: 4294967295,
                    pos: 9223372032711395593,
                    length: 18446744073709027327,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 219,
                container: 149,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 2267596630907625247,
                    length: 18446744073709551391,
                    prop: 18446744073693429759,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 120,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 151587081,
                    pos: 18444492273895866367,
                    length: 18446744069649465343,
                    prop: 18446744072989704191,
                }),
            },
            Handle {
                site: 37,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-1),
                    bool: true,
                    key: 4294967295,
                    pos: 18446744069566171401,
                    length: 18446744073709027327,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 219,
                container: 149,
                action: Generic(GenericAction {
                    value: Container(MovableList),
                    bool: true,
                    key: 4294913857,
                    pos: 18388060938407193507,
                    length: 18446744073709494271,
                    prop: 18446744073709551615,
                }),
            },
            Handle {
                site: 31,
                target: 95,
                container: 120,
                action: Generic(GenericAction {
                    value: I32(-1),
                    bool: true,
                    key: 4294967295,
                    pos: 2242545357980434431,
                    length: 18446744073694814072,
                    prop: 651061559686070271,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Sync { from: 163, to: 255 },
            SyncAllUndo {
                site: 43,
                op_len: 2214581759,
            },
            SyncAll,
            SyncAll,
            SyncAllUndo {
                site: 131,
                op_len: 4281287081,
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 55,
                container: 57,
                action: Generic(GenericAction {
                    value: I32(-13552072),
                    bool: true,
                    key: 4294967295,
                    pos: 2242545357980434431,
                    length: 18400582177514266488,
                    prop: 651061559686070271,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Sync { from: 163, to: 255 },
            SyncAll,
            SyncAll,
            Sync { from: 163, to: 255 },
            Handle {
                site: 31,
                target: 31,
                container: 219,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 3078831103,
                    pos: 2242545357980434305,
                    length: 14974415777474989855,
                    prop: 14974415777481871311,
                }),
            },
            Sync { from: 207, to: 207 },
            Sync { from: 207, to: 207 },
            Sync { from: 207, to: 207 },
            Sync { from: 31, to: 31 },
            SyncAllUndo {
                site: 151,
                op_len: 1099142549,
            },
            Checkout {
                site: 255,
                to: 797179861,
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(891232031),
                    bool: true,
                    key: 522156063,
                    pos: 18446744073709549567,
                    length: 144114526650892287,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 219,
                action: Generic(GenericAction {
                    value: Container(Map),
                    bool: true,
                    key: 732168191,
                    pos: 2305842113780110847,
                    length: 18434921212611133231,
                    prop: 18446743111636823939,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 255,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294913535,
                    pos: 18446744073709551615,
                    length: 2242545357995114271,
                    prop: 1729135000460140319,
                }),
            },
            SyncAll,
            Handle {
                site: 219,
                target: 149,
                container: 149,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4292214571,
                    pos: 18446743111636823939,
                    length: 18446744073709551615,
                    prop: 18446744073695789055,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(892673823),
                    bool: true,
                    key: 4280229752,
                    pos: 18446744073709551607,
                    length: 18375249427041353727,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 219,
                container: 149,
                action: Generic(GenericAction {
                    value: Container(Map),
                    bool: true,
                    key: 4281050111,
                    pos: 3395714115539566549,
                    length: 9511556229955321855,
                    prop: 18446744069951455023,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Unknown(255)),
                    bool: true,
                    key: 4294967295,
                    pos: 18446744073709497855,
                    length: 2305842047141019647,
                    prop: 2242545357980376863,
                }),
            },
            Sync { from: 163, to: 255 },
            Handle {
                site: 31,
                target: 31,
                container: 219,
                action: Generic(GenericAction {
                    value: Container(Map),
                    bool: true,
                    key: 732168191,
                    pos: 2305842113780110847,
                    length: 18446744073709551615,
                    prop: 18385945478740049919,
                }),
            },
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(-1780771553),
                    bool: true,
                    key: 2508428695,
                    pos: 15420091632514445121,
                    length: 18446497783091266559,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 37,
                action: Generic(GenericAction {
                    value: I32(2015311157),
                    bool: true,
                    key: 3250700575,
                    pos: 13961653357748797889,
                    length: 13961653357748797889,
                    prop: 13961653357748797889,
                }),
            },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            SyncAll,
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: Container(Tree),
                    bool: true,
                    key: 792827267,
                    pos: 9511556229955321855,
                    length: 18446744069951455023,
                    prop: 18446744073709551615,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 31,
                action: Generic(GenericAction {
                    value: I32(891232031),
                    bool: true,
                    key: 522156063,
                    pos: 18446744073709549567,
                    length: 13961721794801958911,
                    prop: 13961653357748797889,
                }),
            },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            Sync { from: 193, to: 193 },
            SyncAll,
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 219,
                action: Generic(GenericAction {
                    value: Container(Map),
                    bool: true,
                    key: 732168191,
                    pos: 2305842113780110847,
                    length: 18446744073709551615,
                    prop: 18446743171766419455,
                }),
            },
            SyncAll,
            SyncAll,
            Handle {
                site: 31,
                target: 31,
                container: 14,
                action: Generic(GenericAction {
                    value: I32(-16777216),
                    bool: true,
                    key: 522133503,
                    pos: 10779248702831402783,
                    length: 18446744070207407032,
                    prop: 2242545357980434431,
                }),
            },
        ],
    )
}
